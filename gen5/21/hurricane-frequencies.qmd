---
title: "Overfitting example using hurricane frequencies"
author: "Steve Simon"
source: new
date: "2021-12-11"
categories:
- "*Blog post"
- 2021
- Generalized linear model
- Rmarkdown graphs
output: html_document
page_update: complete
execute:
  echo: false
---

```{r}
#| label: notes
#| echo: false

# Note: this code can produce a reasonable PowerPoint
# presentation. The system has an annoying tendency
# to put the graphs and the speaker notes on separate
# slides.
```

### Overfitting

Overfitting occurs when a statistical model is too complex for the amount of data that it is based on. The summary statistics on the data itself appear to be quite good, but the model will almost always produce poor predictions for new data. Here is an example of overfitting using [data on hurricane frequencies][dasl1] from the [Data and Story Library site][dasl2].

```{r}
#| label: hurricane-frequencies-01
#| echo: false

library(broom)
library(dplyr)
library(ggplot2)
library(knitr)
library(magrittr)
```

### The data used in this example (1/2)

```{r}
#| label: hurricane-frequencies-02

fn <- "https://dasl.datadescription.com/download/data/3279"
raw_data <- read.delim(file=fn, header=TRUE, sep="\t")
raw_data[1:8, ]
```

::: notes

Here are the first eight rows of data. 

:::

### The data used in this example (2/2)

```{r}
#| label: hurricane-frequencies-03

raw_data[9:16, ]
```

::: notes

Here is the rest of the data.

:::

### Plot the data

```{r}
#| label: hurricane-frequencies-04

df <- data.frame(x=seq(1855, 1995, by=10), y=raw_data$Count[1:15])
ggplot(df, aes(x, y)) + 
  geom_point() -> point_plot
plot(point_plot)
```

::: notes

Here's what the data looks like in a graph. Nothing too unusual about the data. Now let's try to forecast the number of hurricanes for the next decade.

:::

### Plot the data with a linear prediction

```{r}
#| label: hurricane-frequencies-05

add_trend <- function(point_plot, df, degree) {
  x_grid <- data.frame(x=seq(1855, 2005, by=0.1))
  lm(y~poly(x, degree), data=df) %>%
    augment(newdata=x_grid) -> yhat
  yhat_2005 <- filter(yhat, x==2005)
  prediction <<- yhat_2005$.fitted
  point_plot +
    geom_line(data=yhat, aes(x, .fitted)) +
    geom_label(
      data=yhat_2005, 
      aes(x, .fitted, label=round(.fitted, 1)))
}
add_trend(point_plot, df, 1)
```

::: notes

Here's a linear trend. The prediction is `r prediction` for the next decade.

:::

### Plot the data with a quadratic prediction

```{r}
#| label: hurricane-frequencies-06

add_trend(point_plot, df, 2)
```

::: notes

Here's a quadratic trend. The prediction is `r prediction`. It's quite a bit different.

:::

### Plot the data with a cubic prediction

```{r}
#| label: hurricane-frequencies-07

add_trend(point_plot, df, 3)
```

::: notes

Here's a cubic (third order polynomial trend. The prediction is now `r prediction`.

:::

### Plot the data with a 4th order polynomial

```{r}
#| label: hurricane-frequencies-08

add_trend(point_plot, df, 4)
```

::: notes

Here's a quartic (fourth order polynomial) trend. The prediction is `r prediction`.

:::

### Plot the data with a 5th order polynomial

```{r}
#| label: hurricane-frequencies-09

add_trend(point_plot, df, 5)
```

::: notes

Here's a fifth order polynomial trend. The prediction is `r prediction`.

:::

### Plot the data with a 6th order polynomial

```{r}
#| label: hurricane-frequencies-10

add_trend(point_plot, df, 6)
```

::: notes

Here's where things get very weird. The sixth order polynomial produces a prediction of `r prediction`, which is more than twice as large as any previous value.

:::

### Plot the data with a 7th order polynomial

```{r}
#| label: hurricane-frequencies-11}
add_trend(point_plot, df, 7)
```

::: notes

The weirdness continues with the seventh order polynomial trend, which produces a negative prediction (`r prediction`.

:::

### Plot the data with a 8th order polynomial

```{r}
#| label: hurricane-frequencies-12

add_trend(point_plot, df, 8)
```

::: notes

The eigth order polynomial trend also produces a negative prediction (`r prediction`).

:::

### Plot the data with a 9th order polynomial

```{r}
#| label: hurricane-frequencies-13

add_trend(point_plot, df, 9)
```

::: notes

Here's a ninth order polynomial trend. The prediction is so extreme (`r prediction`) as to be ridiculous.

:::

### Plot the data with a 10th order polynomial

```{r}
#| label: hurricane-frequencies-14

add_trend(point_plot, df, 10)
```

::: notes

For the record, here are the tenth...

:::



### Plot the data with a 11th order polynomial

```{r}
#| label: hurricane-frequencies-15

add_trend(point_plot, df, 11)
```

::: notes

... eleventh ... 

:::

### Plot the data with a 12th order polynomial

```{r}
#| label: hurricane-frequencies-16

add_trend(point_plot, df, 12)
```

::: notes

... twelfth ...

:::

### Plot the data with a 13th order polynomial

```{r}
#| label: hurricane-frequencies-17

add_trend(point_plot, df, 13)
```

::: notes

... thirteenth ...

:::

### Plot the data with a 14th order polynomial

```{r}
#| label: hurricane-frequencies-18

add_trend(point_plot, df, 14)
```

::: notes

... and fourteenth order polynomials.

:::



### Code (load libraries)

```{r}
#| label: hurricane-frequencies-19
#| echo: true
#| eval: false

knitr::opts_chunk$set(echo=TRUE)
knitr::opts_chunk$set(eval=FALSE)
```

```{r}
#| label: hurricane-frequencies-01
```

::: notes

Here are the libraries that I needed for this work.

:::

### Code (read and print)

```{r}
#| label: hurricane-frequencies-02
```

```{r}
#| label: hurricane-frequencies-03
```

::: notes

This code reads data directly from the website and prints out the data in two pieces.

:::

### Code (plot data points)

```{r}
#| label: hurricane-frequencies-04
```

::: notes

Here's the code for plotting the data points. I save the graph in an object so I can add trend lines later on.

:::

### Code that I used

```{r}
#| label: hurricane-frequencies-05
```

::: notes

Here's the code for adding a trend line to the graph. I am setting up a flexible function that can print the trend from any polynomial.

:::

### Code that I used

```{r}
#| label: hurricane-frequencies-06
```

```{r}
#| label: hurricane-frequencies-07
```

```{r}
#| label: hurricane-frequencies-08
```

```{r}
#| label: hurricane-frequencies-09
```

```{r}
#| label: hurricane-frequencies-10
```

```{r}
#| label: hurricane-frequencies-11
```

```{r}
#| label: hurricane-frequencies-12
```

```{r}
#| label: hurricane-frequencies-13
```

```{r}
#| label: hurricane-frequencies-14
```

```{r}
#| label: hurricane-frequencies-15
```

```{r}
#| label: hurricane-frequencies-16
```

```{r}
#| label: hurricane-frequencies-17
```

```{r}
#| label: hurricane-frequencies-18
```

::: notes

It took a bit of work to put everything in a function, but now you can produce a quadratic or higher level trend rather than a linear trend with just a single line of code.

:::

[dasl2]: https://dasl.datadescription.com/datafile/hurricane-frequencies/
[dasl1]: https://dasl.datadescription.com/

An [earlier version][sim2] of this page was published on [new.pmean.com][sim1].

[sim1]: http://new.pmean.com
[sim2]: http://new.pmean.com/hurricane-frequencies/
