---
title: "Interpreting ratios after a log transformation"
author: "Steve Simon"
source: new
date: "2025-11-07"
categories:
- Blog post
tags:
- Modeling issues
format: 
  html:
    embed-resources: true
editor: source
execute: 
  error: true
  echo: true
page_update: complete
---

I was helping a student team doing an analysis of factors affecting length of stay. This is a highly skewed variable and shows the advantage of using a log transformation. I am reproducing the analysis here using an artificial dataset that very loosely approximates the actual data. This page will help with how to identify skewness, how to fit a model after a log transformation, and how to interpret the results clearly.

<!---more--->

```{r}
#| label: setup
#| message: false
#| warning: false

library(broom)
library(tidyverse)
```

```{r}
#| label: generate-data

# Generating artificial data that closely mirrors the original data is a bit 
# tricky. The mean and standard deviation after a log base 2 transformation are 
# 5.7 and 2.6. So compute a normal distribution based on these, add in the 
# effect of a few covariates and then back transform to the original scale.

# Age has a slight but statistically significant affect on log_los with a slope
# on the log scale of 0.008. Age has a mean of 55 and a standard deviation of
# 18

# Gender has a not statistically significant affect on log_los with males having
# a mean which is 0.4 unit higher. Males account for about 50% of the data.

# Acute status has a large and statistically significant impact on log_los with
# non-acute cases being smaller on average by 1.3 log units. Acute cases account
# for 95% of the cases.

data.frame(log_los=rnorm(8000, mean=5.7, sd=2.6)) |>
  mutate(age=runif(8000, min=20, max=90)) |>
  mutate(age=trunc(age)) |>
  mutate(log_los=log_los+(age-55)*0.008) |>
  mutate(gender=rbinom(8000, 1, 0.5)) |>
  mutate(log_los=log_los+(gender-0.5)*0.4) |>
  mutate(acute=rbinom(8000, 1, 0.95)) |>
  mutate(log_los=log_los+(acute-0.95)*1.3) |>
	mutate(log_los=pmax(log_los, abs(log_los))) |>
  mutate(los=2^log_los) |>
  mutate(los=trunc(los)) |>
	mutate(log_los=log2(los)) -> d5
glimpse(d5)
```

```{r}
#| label: descriptives-los

d5 |>
	summarize(
		los_mean=mean(los),
		los_median=median(los),
		los_sd=sd(los),
		los_min=min(los),
		los_max=max(los),
		n=n())
```

```{r}
#| label: los histogram

d5 |>
  ggplot() +
  aes(los) +
	geom_histogram(binwidth=7*24, color="black", fill="white")
```

```{r}
#| label: descriptives-log-los

d5 |>
	summarize(
		log_los_mean=mean(log_los),
		log_los_median=median(log_los),
		log_los_sd=sd(log_los),
		log_los_min=min(log_los),
		log_los_max=max(log_los),
		n=n())
```

```{r}
#| label: log_los histogram

d5 |>
  ggplot() +
  aes(log_los) +
	geom_histogram(binwidth=1, color="black", fill="white")
```
